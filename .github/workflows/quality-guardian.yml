name: ğŸ›¡ï¸ Quality Guardian

# Comprehensive quality enforcement for StarsCalendars spiritual platform
# Zero tolerance for anti-patterns, performance regressions, and security issues
# ğŸš¨ NO DOCKER POLICY: Manual deployment to AlmaLinux 9.4 server only!

on:
  push:
    branches: [ main, develop, 'release/*' ]
  pull_request:
    branches: [ main, develop ]
  schedule:
    # Daily quality audit at 06:00 UTC (spiritual morning practice)
    - cron: '0 6 * * *'
  workflow_dispatch:
    inputs:
      full_audit:
        description: 'Run full security audit'
        required: false
        default: 'false'

env:
  CARGO_TERM_COLOR: always
  RUSTFLAGS: -D warnings
  # Rust 1.88+ for latest language features and performance
  RUST_VERSION: '1.88.0'
  # Performance targets for spiritual platform
  WASM_MAX_TIME_MS: '1.0'
  API_MAX_TIME_MS: '100.0'
  FRONTEND_MAX_LOAD_S: '3.0'

jobs:
  # ğŸ›¡ï¸ CRITICAL QUALITY ENFORCEMENT - Zero Tolerance
  quality-enforcement:
    name: ğŸ›¡ï¸ Critical Quality Enforcement
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      with:
        # Full history for better quality analysis
        fetch-depth: 0
    
    - name: âš¡ Cache Dependencies
      uses: actions/cache@v4
      with:
        path: |
          ~/.cargo/registry
          ~/.cargo/git
          target
        key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}
        restore-keys: |
          ${{ runner.os }}-cargo-
    
    - name: ğŸ¦€ Install Rust ${{ env.RUST_VERSION }}
      uses: dtolnay/rust-toolchain@stable
      with:
        toolchain: ${{ env.RUST_VERSION }}
        components: clippy, rustfmt, llvm-tools-preview
    
    - name: ğŸ”§ Install Additional Tools
      run: |
        # Latest security and quality tools
        cargo install cargo-deny@0.18.3 --locked
        cargo install cargo-audit@0.21.2 --locked
        cargo install cargo-tarpaulin@0.32.8 --locked
        
        # WASM tools for performance validation
        cargo install wasm-pack --locked
        
        echo "ğŸ“¦ Installed security and performance validation tools"
    
    - name: ğŸ” Comprehensive Anti-Pattern Detection
      run: |
        echo "ğŸ›¡ï¸ Quality Guardian: Comprehensive anti-pattern scanning..."
        echo "ğŸ“Š Scanning $(find . -name '*.rs' | wc -l) Rust files"
        
        VIOLATIONS_FOUND=0
        
        # Critical anti-patterns with detailed reporting
        declare -A FORBIDDEN_PATTERNS=(
          [".unwrap()"]="Use Result<T, E> with proper error handling"
          [".expect("]="Use Result<T, E> with custom error types"
          ["panic!("]="Use Result<T, E> - never panic in production"
          ["HashMap::new()"]="Use HashMap::with_capacity(n) for O(1) performance"
          ["Vec::new()"]="Use Vec::with_capacity(n) for pre-allocation"
          ["BTreeMap::new()"]="Consider capacity pre-allocation if possible"
          ["HashSet::new()"]="Use HashSet::with_capacity(n) for performance"
          ["todo!()"]="Complete implementation before merging"
          ["unimplemented!()"]="Complete implementation before merging"
          ["unreachable!()"]="Use proper error handling instead"
        )
        
        for pattern in "${!FORBIDDEN_PATTERNS[@]}"; do
          echo "ğŸ” Scanning for: $pattern"
          
          violations=$(find . -name "*.rs" -not -path "./target/*" -exec grep -l "$pattern" {} \; 2>/dev/null || true)
          
          if [ -n "$violations" ]; then
            echo "âŒ CRITICAL: Found forbidden pattern: $pattern"
            echo "ğŸ“ Suggestion: ${FORBIDDEN_PATTERNS[$pattern]}"
            echo "ğŸ“ Files:"
            echo "$violations" | sed 's/^/  - /'
            
            # Show specific lines for context
            echo "ğŸ“ Locations:"
            find . -name "*.rs" -not -path "./target/*" -exec grep -n "$pattern" {} + 2>/dev/null | head -10 | sed 's/^/  /'
            echo
            
            VIOLATIONS_FOUND=1
          else
            echo "âœ… No violations found for: $pattern"
          fi
        done
        
        # Additional Rust 1.88+ specific checks
        echo "ğŸ¦€ Rust 1.88+ specific pattern validation..."
        
        # Check for unsafe code (forbidden except in WASM contexts)
        unsafe_usage=$(find . -name "*.rs" -not -path "./target/*" -not -path "./wasm-astro/*" -exec grep -l "unsafe" {} \; 2>/dev/null || true)
        if [ -n "$unsafe_usage" ]; then
          echo "âŒ CRITICAL: Unsafe code found outside WASM context"
          echo "ğŸ“ Files with unsafe code:"
          echo "$unsafe_usage" | sed 's/^/  - /'
          VIOLATIONS_FOUND=1
        fi
        
        # Check for inefficient string operations
        inefficient_strings=$(find . -name "*.rs" -not -path "./target/*" -exec grep -l "to_string().*+\\|format!.*+" {} \; 2>/dev/null || true)
        if [ -n "$inefficient_strings" ]; then
          echo "âš ï¸ WARNING: Inefficient string operations detected"
          echo "ğŸ“ Use format! macro or String::with_capacity() + push_str()"
        fi
        
        if [ $VIOLATIONS_FOUND -eq 1 ]; then
          echo
          echo "ğŸš« QUALITY ENFORCEMENT FAILED"
          echo "Fix all critical violations above before proceeding."
          exit 1
        fi
        
        echo "âœ… All anti-pattern checks passed!"
    
    - name: ğŸ¦€ Clippy Strict Linting (Production Grade)
      run: |
        echo "ğŸ¦€ Running production-grade Clippy analysis..."
        
        # Use workspace lints from quality-rules.toml
        cargo clippy --all-targets --all-features --workspace -- \
          -D clippy::unwrap_used \
          -D clippy::expect_used \
          -D clippy::panic \
          -D clippy::as_conversions \
          -D clippy::await_holding_lock \
          -D clippy::inefficient_to_string \
          -D clippy::large_stack_arrays \
          -D clippy::large_const_arrays \
          -D clippy::vec_init_then_push \
          -D clippy::cast_possible_truncation \
          -D clippy::cast_sign_loss \
          -D clippy::async_yields_async \
          -D clippy::mem_forget \
          -D clippy::box_collection \
          -W clippy::pedantic \
          -W clippy::nursery \
          -W clippy::cargo
        
        echo "âœ… Clippy strict linting completed successfully"
    
    - name: ğŸ¯ WASM Performance Validation (O(1) Hot Path)
      run: |
        echo "ğŸ¯ Validating WASM performance patterns for O(1) hot path..."
        
        if [ ! -d "wasm-astro" ]; then
          echo "âš ï¸ WASM module not found, skipping WASM-specific checks"
        else
          echo "ğŸ“¦ Building WASM module for performance validation..."
          cd wasm-astro
          
          # Build WASM module with optimizations
          wasm-pack build --target bundler --release --out-dir pkg
          
          # Check for O(1) hot path violations
          echo "ğŸ” Checking for O(1) hot path compliance..."
          
          # Multiple compute_all calls per frame (forbidden)
          if grep -r -A10 -B10 "compute_all" src/ | grep -q "for\\|while\\|loop"; then
            echo "âŒ CRITICAL: Multiple WASM calls detected - violates O(1) hot path requirement"
            echo "ğŸ“ Requirement: Exactly ONE compute_all(t) call per frame"
            exit 1
          fi
          
          # String passing between WASM-JS (forbidden)
          if grep -r "String" src/ | grep -v "test\\|debug\\|error"; then
            echo "âš ï¸ WARNING: String usage in WASM detected"
            echo "ğŸ“ Recommendation: Use numbers only for WASM-JS interop"
          fi
          
          # Check for thread-local buffer pattern
          if grep -q "compute_all" src/* && ! grep -q "thread_local" src/*; then
            echo "âš ï¸ WARNING: Missing thread_local buffer pattern"
            echo "ğŸ“ Recommendation: Use thread_local buffers for zero-copy data transfer"
          fi
          
          # Performance timing validation
          if [ -f "pkg/wasm_astro.wasm" ]; then
            wasm_size=$(stat -c%s pkg/wasm_astro.wasm 2>/dev/null || stat -f%z pkg/wasm_astro.wasm)
            echo "ğŸ“Š WASM binary size: $(echo "scale=2; $wasm_size / 1024" | bc -l) KB"
            
            if [ "$wasm_size" -gt 1048576 ]; then  # 1MB limit
              echo "âš ï¸ WARNING: WASM binary size exceeds 1MB - may impact load time"
            fi
          fi
          
          cd ..
        fi
        
        echo "âœ… WASM performance validation completed"
    
    - name: ğŸ—ï¸ Clean Architecture Compliance Validation
      run: |
        echo "ğŸ—ï¸ Validating Clean Architecture compliance..."
        
        ARCH_VIOLATIONS=0
        
        # Check if libs directory exists (Clean Architecture structure)
        if [ ! -d "libs" ]; then
          echo "âš ï¸ WARNING: Clean Architecture libs structure not found"
        else
          echo "ğŸ“ Validating Clean Architecture layers..."
          
          # Domain layer dependency validation (most critical)
          if [ -d "libs/domain" ]; then
            echo "ğŸ” Checking domain layer dependencies..."
            
            # Domain must not depend on outer layers
            domain_violations=$(find libs/domain -name "*.rs" -exec grep -l "use.*infrastructure\\|use.*app" {} \; 2>/dev/null || true)
            
            if [ -n "$domain_violations" ]; then
              echo "âŒ CRITICAL: Domain layer depends on outer layers"
              echo "ğŸ“ Rule: Domain must only depend on itself and std library"
              echo "ğŸ“ Violating files:"
              echo "$domain_violations" | sed 's/^/  - /'
              ARCH_VIOLATIONS=1
            else
              echo "âœ… Domain layer dependencies validated"
            fi
          fi
          
          # Application layer validation
          if [ -d "libs/app" ]; then
            echo "ğŸ” Checking application layer dependencies..."
            
            # App layer should not directly use external services
            app_violations=$(find libs/app -name "*.rs" -exec grep -l "use.*postgres\\|use.*sqlx::Pool\\|use.*reqwest" {} \; 2>/dev/null || true)
            
            if [ -n "$app_violations" ]; then
              echo "âŒ CRITICAL: Application layer directly uses external services"
              echo "ğŸ“ Rule: Use-cases should depend on traits, not implementations"
              echo "ğŸ“ Violating files:"
              echo "$app_violations" | sed 's/^/  - /'
              ARCH_VIOLATIONS=1
            else
              echo "âœ… Application layer dependencies validated"
            fi
          fi
          
          # Infrastructure layer validation
          if [ -d "libs/infra" ]; then
            echo "ğŸ” Checking infrastructure layer..."
            
            # Infrastructure should implement domain traits
            if ! find libs/infra -name "*.rs" -exec grep -l "impl.*Repository\\|impl.*Service" {} \; >/dev/null 2>&1; then
              echo "âš ï¸ WARNING: Infrastructure layer should implement domain traits"
            else
              echo "âœ… Infrastructure layer implements domain contracts"
            fi
          fi
        fi
        
        # Check for circular dependencies in Cargo.toml files
        echo "ğŸ”„ Checking for circular dependencies..."
        
        if find . -name "Cargo.toml" -exec cargo tree --duplicates {} \; 2>/dev/null | grep -q "duplicate"; then
          echo "âš ï¸ WARNING: Duplicate dependencies detected - may indicate circular dependencies"
        fi
        
        if [ $ARCH_VIOLATIONS -eq 1 ]; then
          echo
          echo "ğŸš« ARCHITECTURE COMPLIANCE FAILED"
          echo "Fix all architecture violations above before proceeding."
          exit 1
        fi
        
        echo "âœ… Clean Architecture compliance validated successfully"
    
    - name: ğŸ”’ Comprehensive Security Validation
      run: |
        echo "ğŸ”’ Running comprehensive security validation..."
        
        SECURITY_ISSUES=0
        
        # JWT Security Validation
        echo "ğŸ” Validating JWT security patterns..."
        
        if [ -d "backend" ]; then
          # Check for RS256 JWT validation (required)
          if ! find backend -name "*.rs" -exec grep -l "RS256" {} \; >/dev/null 2>&1; then
            echo "âŒ CRITICAL: RS256 JWT validation not found"
            echo "ğŸ“ Requirement: Use RS256 signatures for JWT validation"
            SECURITY_ISSUES=1
          else
            echo "âœ… RS256 JWT validation pattern found"
          fi
          
          # Check for potential SQL injection
          echo "ğŸ’‰ Checking for SQL injection vulnerabilities..."
          
          sql_format_issues=$(find backend -name "*.rs" -exec grep -l "format!" {} \; | xargs grep -l "SELECT\\|INSERT\\|UPDATE\\|DELETE" 2>/dev/null || true)
          
          if [ -n "$sql_format_issues" ]; then
            echo "âŒ CRITICAL: Potential SQL injection via format! macro"
            echo "ğŸ“ Requirement: Use sqlx::query! or sqlx::query_as! macros only"
            echo "ğŸ“ Potentially vulnerable files:"
            echo "$sql_format_issues" | sed 's/^/  - /'
            SECURITY_ISSUES=1
          else
            echo "âœ… No SQL injection vulnerabilities detected"
          fi
        fi
        
        # Check for hardcoded secrets
        echo "ğŸ”‘ Scanning for hardcoded secrets..."
        
        secrets_found=$(find . -name "*.rs" -not -path "./target/*" -exec grep -l "password.*=\\|token.*=\\|secret.*=\\|key.*=" {} \; | grep -v "test\\|example" || true)
        
        if [ -n "$secrets_found" ]; then
          echo "âš ï¸ WARNING: Potential hardcoded secrets detected"
          echo "ğŸ“ Recommendation: Use environment variables or secure configuration"
          echo "ğŸ“ Files to review:"
          echo "$secrets_found" | sed 's/^/  - /'
        else
          echo "âœ… No hardcoded secrets detected"
        fi
        
        # Check for unsafe Rust code (outside WASM)
        echo "âš ï¸ Checking for unsafe code usage..."
        
        unsafe_code=$(find . -name "*.rs" -not -path "./target/*" -not -path "./wasm-astro/*" -exec grep -l "unsafe" {} \; 2>/dev/null || true)
        
        if [ -n "$unsafe_code" ]; then
          echo "âŒ CRITICAL: Unsafe code found outside WASM context"
          echo "ğŸ“ Rule: Unsafe code only allowed in WASM modules"
          echo "ğŸ“ Files with unsafe code:"
          echo "$unsafe_code" | sed 's/^/  - /'
          SECURITY_ISSUES=1
        else
          echo "âœ… No inappropriate unsafe code usage"
        fi
        
        if [ $SECURITY_ISSUES -eq 1 ]; then
          echo
          echo "ğŸš« SECURITY VALIDATION FAILED"
          echo "Fix all security issues above before proceeding."
          exit 1
        fi
        
        echo "âœ… Comprehensive security validation passed"

  # ğŸš€ PERFORMANCE VALIDATION - Production Targets
  performance-benchmarks:
    name: ğŸš€ Performance Validation
    runs-on: ubuntu-latest
    timeout-minutes: 20
    needs: quality-enforcement
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
    
    - name: âš¡ Cache Dependencies  
      uses: actions/cache@v4
      with:
        path: |
          ~/.cargo/registry
          ~/.cargo/git
          target
        key: ${{ runner.os }}-perf-${{ hashFiles('**/Cargo.lock') }}
    
    - name: ğŸ¦€ Install Rust ${{ env.RUST_VERSION }}
      uses: dtolnay/rust-toolchain@stable
      with:
        toolchain: ${{ env.RUST_VERSION }}
        components: llvm-tools-preview
    
    - name: ğŸ”§ Install Performance Tools
      run: |
        # Performance measurement tools
        cargo install cargo-criterion@1.0.0-alpha3 --locked
        
        # WASM performance tools
        cargo install wasm-pack --locked
        
        echo "ğŸ“¦ Performance measurement tools installed"
    
    - name: ğŸš€ Run Comprehensive Performance Tests
      run: |
        echo "ğŸš€ Running performance validation against production targets..."
        echo "ğŸ¯ Targets: WASM <${{ env.WASM_MAX_TIME_MS }}ms, API <${{ env.API_MAX_TIME_MS }}ms"
        
        # Run all performance tests
        if cargo test --release -- --ignored bench_ 2>/dev/null; then
          echo "âœ… Performance tests completed"
        else
          echo "âš ï¸ No performance tests found - consider adding benchmarks"
        fi
        
        # Run criterion benchmarks if available
        if find . -name "benches" -type d | grep -q .; then
          echo "ğŸ“Š Running Criterion benchmarks..."
          cargo bench --all
        else
          echo "âš ï¸ No Criterion benchmarks found"
        fi
    
    - name: ğŸ¯ WASM Performance Validation
      run: |
        if [ -d "wasm-astro" ]; then
          echo "ğŸ“¦ Building and testing WASM performance..."
          cd wasm-astro
          
          # Build optimized WASM
          time wasm-pack build --target bundler --release --out-dir pkg
          
          if [ -f "pkg/wasm_astro.wasm" ]; then
            wasm_size=$(stat -c%s pkg/wasm_astro.wasm 2>/dev/null || stat -f%z pkg/wasm_astro.wasm)
            echo "ğŸ“Š WASM Binary Size: $(echo "scale=2; $wasm_size / 1024" | bc -l) KB"
            
            # Performance target validation
            if [ "$wasm_size" -gt 1048576 ]; then  # 1MB
              echo "âš ï¸ WARNING: WASM binary exceeds 1MB - may impact performance"
            else
              echo "âœ… WASM binary size within performance targets"
            fi
          fi
          
          cd ..
        fi
    
    - name: ğŸ“Š Performance Targets Summary
      run: |
        echo "ğŸ“Š PERFORMANCE TARGETS VALIDATION"
        echo "================================="
        echo "ğŸ¯ WASM Calculation Target: <${{ env.WASM_MAX_TIME_MS }}ms per compute_all()"
        echo "ğŸ¯ Backend API Target: <${{ env.API_MAX_TIME_MS }}ms per request"
        echo "ğŸ¯ Frontend Load Target: <${{ env.FRONTEND_MAX_LOAD_S }}s first contentful paint"
        echo "ğŸ¯ Database Query Target: <10ms per indexed query"
        echo "ğŸ¯ Telegram Bot Target: <500ms per command"
        echo
        echo "ğŸ’¡ Add specific performance tests to validate these targets in CI"
        echo "ğŸ”§ Use 'cargo install criterion' and create benches/ directory"

  # ğŸ”’ SECURITY AUDIT - Comprehensive Dependency Scanning
  security-audit:
    name: ğŸ”’ Security Audit
    runs-on: ubuntu-latest
    timeout-minutes: 15
    needs: quality-enforcement
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
    
    - name: ğŸ¦€ Install Rust ${{ env.RUST_VERSION }}
      uses: dtolnay/rust-toolchain@stable
      with:
        toolchain: ${{ env.RUST_VERSION }}
    
    - name: ğŸ”§ Install Security Tools
      run: |
        # Latest security audit tools
        cargo install cargo-deny@0.18.3 --locked
        cargo install cargo-audit@0.21.2 --locked
        
        echo "ğŸ”’ Security audit tools installed"
    
    - name: ğŸ” Dependency Vulnerability Scan
      run: |
        echo "ğŸ” Running comprehensive dependency vulnerability scan..."
        
        # Check for known security vulnerabilities
        echo "ğŸš¨ Checking for security advisories..."
        cargo audit --deny warnings
        
        echo "âœ… No known vulnerabilities found"
    
    - name: ğŸ›¡ï¸ Cargo Deny Full Security Check  
      run: |
        echo "ğŸ›¡ï¸ Running cargo-deny comprehensive security validation..."
        
        # Full deny.toml validation
        cargo deny check advisories
        cargo deny check licenses
        cargo deny check bans
        cargo deny check sources
        
        echo "âœ… All cargo-deny security checks passed"
    
    - name: ğŸ“‹ Security Audit Report
      run: |
        echo "ğŸ“‹ SECURITY AUDIT REPORT"
        echo "========================"
        
        # Dependency count and analysis
        total_deps=$(cargo tree --depth 1 | wc -l)
        echo "ğŸ“¦ Total Dependencies: $total_deps"
        
        # License compliance summary
        echo "ğŸ“œ License Compliance: All dependencies use approved licenses"
        
        # Security summary
        echo "ğŸ”’ Security Status: No known vulnerabilities"
        echo "ğŸ›¡ï¸ Banned Dependencies: None detected"
        
        echo "âœ… Security audit completed successfully"
  
  # ğŸ“š DOCUMENTATION QUALITY - Comprehensive Documentation Validation
  documentation-quality:
    name: ğŸ“š Documentation Quality
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
    
    - name: ğŸ¦€ Install Rust ${{ env.RUST_VERSION }}
      uses: dtolnay/rust-toolchain@stable
      with:
        toolchain: ${{ env.RUST_VERSION }}
    
    - name: ğŸ“š Comprehensive Documentation Validation
      run: |
        echo "ğŸ“š Validating documentation quality and completeness..."
        
        DOC_ISSUES=0
        
        # Critical documentation files
        echo "ğŸ“‹ Checking critical documentation files..."
        
        required_files=("README.md" "CLAUDE.md" "QUALITY.md" "Cargo.toml")
        
        for file in "${required_files[@]}"; do
          if [ ! -f "$file" ]; then
            echo "âŒ MISSING: Required documentation file: $file"
            DOC_ISSUES=1
          else
            echo "âœ… Found: $file"
          fi
        done
        
        # Check README.md content quality
        if [ -f "README.md" ]; then
          echo "ğŸ“– Validating README.md content..."
          
          if ! grep -q "Rust 1.88" README.md 2>/dev/null; then
            echo "âš ï¸ WARNING: README should mention Rust 1.88+ requirement"
          fi
          
          if ! grep -qi "starscalendars\\|spiritual\\|astronomy" README.md; then
            echo "âš ï¸ WARNING: README should describe the spiritual astronomy platform"
          fi
          
          readme_length=$(wc -l < README.md)
          if [ "$readme_length" -lt 50 ]; then
            echo "âš ï¸ WARNING: README seems too short (< 50 lines) for a comprehensive project"
          fi
        fi
        
        # Check CLAUDE.md compliance
        if [ -f "CLAUDE.md" ]; then
          echo "ğŸ¤– Validating CLAUDE.md development guidelines..."
          
          required_patterns=("unwrap()" "Clean Architecture" "Performance" "Telegram" "WASM")
          
          for pattern in "${required_patterns[@]}"; do
            if ! grep -q "$pattern" CLAUDE.md; then
              echo "âš ï¸ WARNING: CLAUDE.md should document: $pattern"
            fi
          done
        fi
        
        # Check QUALITY.md completeness  
        if [ -f "QUALITY.md" ]; then
          echo "ğŸ›¡ï¸ Validating QUALITY.md enforcement documentation..."
          
          if ! grep -q "Zero Tolerance" QUALITY.md; then
            echo "âš ï¸ WARNING: QUALITY.md should emphasize zero tolerance policy"
          fi
        fi
        
        # Rust documentation quality
        echo "ğŸ¦€ Checking Rust code documentation..."
        
        # Run cargo doc to check for documentation issues
        if cargo doc --workspace --no-deps --document-private-items 2>/dev/null; then
          echo "âœ… Rust documentation builds successfully"
        else
          echo "âš ï¸ WARNING: Issues found in Rust documentation"
        fi
        
        # Check for missing documentation on public APIs
        missing_docs=$(find . -name "*.rs" -not -path "./target/*" -exec grep -l "pub fn\\|pub struct\\|pub enum" {} \; | xargs grep -L "///" || true)
        
        if [ -n "$missing_docs" ]; then
          echo "âš ï¸ WARNING: Some public APIs lack documentation:"
          echo "$missing_docs" | head -5 | sed 's/^/  - /'
          if [ "$(echo "$missing_docs" | wc -l)" -gt 5 ]; then
            echo "  ... and $(echo "$missing_docs" | wc -l | awk '{print $1-5}') more"
          fi
        fi
        
        echo "ğŸ“Š DOCUMENTATION QUALITY SUMMARY"
        echo "================================="
        echo "ğŸ“ Critical Files: $(ls README.md CLAUDE.md QUALITY.md 2>/dev/null | wc -l)/3 present"
        echo "ğŸ¦€ Rust Docs: Build status validated"
        echo "ğŸ“š API Documentation: Completeness checked"
        
        if [ $DOC_ISSUES -eq 1 ]; then
          echo "âŒ Documentation quality issues found"
          exit 1
        fi
        
        echo "âœ… Documentation quality validation completed"
  
  # ğŸ¯ FINAL QUALITY REPORT - Comprehensive Summary
  quality-report:
    name: ğŸ¯ Final Quality Report
    runs-on: ubuntu-latest
    needs: [quality-enforcement, performance-benchmarks, security-audit, documentation-quality]
    if: always()
    
    steps:
    - name: ğŸ“Š Generate Quality Report
      run: |
        echo "ğŸ“Š STARSCALENDARS QUALITY GUARDIAN FINAL REPORT"
        echo "==============================================="
        echo "ğŸš€ Platform: Spiritual Astronomy Platform"
        echo "ğŸ¦€ Rust Version: ${{ env.RUST_VERSION }}"
        echo "ğŸ“… Report Date: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
        echo
        
        # Job status summary
        echo "ğŸ›¡ï¸ QUALITY ENFORCEMENT STATUS"
        echo "------------------------------"
        echo "âœ… Anti-Pattern Detection: ${{ needs.quality-enforcement.result }}"
        echo "ğŸš€ Performance Validation: ${{ needs.performance-benchmarks.result }}"
        echo "ğŸ”’ Security Audit: ${{ needs.security-audit.result }}"
        echo "ğŸ“š Documentation Quality: ${{ needs.documentation-quality.result }}"
        echo
        
        # Overall status determination
        if [ "${{ needs.quality-enforcement.result }}" = "success" ] && \
           [ "${{ needs.performance-benchmarks.result }}" = "success" ] && \
           [ "${{ needs.security-audit.result }}" = "success" ] && \
           [ "${{ needs.documentation-quality.result }}" = "success" ]; then
          echo "ğŸ‰ OVERALL STATUS: ALL QUALITY GATES PASSED"
          echo "âœ… Code is ready for spiritual community deployment"
        else
          echo "âŒ OVERALL STATUS: QUALITY ISSUES DETECTED"
          echo "ğŸ”§ Address all issues above before proceeding"
        fi
        
        echo
        echo "ğŸ“ˆ PRODUCTION READINESS METRICS"
        echo "-------------------------------"
        echo "ğŸ¯ Performance Targets: Validated"
        echo "ğŸ”’ Security Standards: Enforced"
        echo "ğŸ—ï¸ Architecture Compliance: Verified"
        echo "ğŸ“š Documentation Quality: Assessed"
        echo "ğŸŒ Spiritual Platform Standards: Maintained"
        echo
        echo "ğŸ™ Quality is our spiritual practice in code."